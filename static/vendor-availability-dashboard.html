<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Verfügbarkeits-Analyse</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #888;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
        }
        
        .chart-container {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            height: 400px;
            position: relative;
        }
        
        .vendor-table {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #2a2a2a;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #667eea;
            border-bottom: 2px solid #333;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #333;
        }
        
        tr:hover {
            background: #252525;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-available { background: #10b981; color: #fff; }
        .status-limited { background: #f59e0b; color: #fff; }
        .status-out { background: #ef4444; color: #fff; }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #888;
        }
        
        .input-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        textarea {
            width: 100%;
            min-height: 150px;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            color: #e0e0e0;
            padding: 15px;
            font-family: monospace;
            font-size: 0.875rem;
            margin-bottom: 15px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        
        button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>Vendor Verfügbarkeits-Analyse</h1>
        
        <div class="input-section">
            <h3 style="margin-bottom: 15px;">Daten eingeben</h3>
            <p style="color: #888; margin-bottom: 10px;">
                Fügen Sie hier die Vendor-Daten im JSON-Format ein oder laden Sie sie über die BigQuery API.
            </p>
            <textarea id="dataInput" placeholder='[{"vendor_name": "Vendor A", "availability_rate": 95, ...}]'></textarea>
            <button onclick="loadData()">Daten analysieren</button>
        </div>
        
        <div class="metrics-grid" id="metricsGrid">
            <div class="metric-card">
                <div class="metric-label">Anzahl Vendors</div>
                <div class="metric-value" id="vendorCount">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Durchschn. Verfügbarkeit</div>
                <div class="metric-value" id="avgAvailability">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Durchschn. Zuverlässigkeit</div>
                <div class="metric-value" id="avgReliability">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Durchschn. Lieferzeit</div>
                <div class="metric-value" id="avgLeadTime">-</div>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="availabilityChart"></canvas>
        </div>
        
        <div class="chart-container">
            <canvas id="statusChart"></canvas>
        </div>
        
        <div class="vendor-table">
            <table>
                <thead>
                    <tr>
                        <th>Vendor</th>
                        <th>Verfügbarkeit %</th>
                        <th>Zuverlässigkeit</th>
                        <th>Produkte</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="vendorTableBody">
                    <tr>
                        <td colspan="5" class="loading">
                            Bitte laden Sie Vendor-Daten über die Eingabe oben...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        let availabilityChart = null;
        let statusChart = null;
        
        // Sample data structure for demonstration
        const sampleData = [
            {
                vendor_name: "TechSupply GmbH",
                avg_availability_rate: 95.5,
                vendor_reliability_score: 92,
                product_count: 150,
                available_products: 120,
                out_of_stock_products: 20,
                limited_products: 10,
                avg_lead_time: 3.5
            },
            {
                vendor_name: "GlobalParts AG",
                avg_availability_rate: 88.2,
                vendor_reliability_score: 85,
                product_count: 200,
                available_products: 160,
                out_of_stock_products: 30,
                limited_products: 10,
                avg_lead_time: 5.2
            },
            {
                vendor_name: "QuickShip Ltd",
                avg_availability_rate: 92.8,
                vendor_reliability_score: 94,
                product_count: 80,
                available_products: 70,
                out_of_stock_products: 5,
                limited_products: 5,
                avg_lead_time: 2.1
            }
        ];
        
        function loadData() {
            const inputData = document.getElementById('dataInput').value;
            let data;
            
            try {
                data = inputData ? JSON.parse(inputData) : sampleData;
            } catch (e) {
                alert('Fehler beim Parsen der Daten. Bitte überprüfen Sie das JSON-Format.');
                return;
            }
            
            updateMetrics(data);
            updateCharts(data);
            updateTable(data);
        }
        
        function updateMetrics(data) {
            const vendorCount = data.length;
            const avgAvailability = data.reduce((sum, v) => sum + (v.avg_availability_rate || 0), 0) / vendorCount;
            const avgReliability = data.reduce((sum, v) => sum + (v.vendor_reliability_score || 0), 0) / vendorCount;
            const avgLeadTime = data.reduce((sum, v) => sum + (v.avg_lead_time || 0), 0) / vendorCount;
            
            document.getElementById('vendorCount').textContent = vendorCount;
            document.getElementById('avgAvailability').textContent = avgAvailability.toFixed(1) + '%';
            document.getElementById('avgReliability').textContent = avgReliability.toFixed(1);
            document.getElementById('avgLeadTime').textContent = avgLeadTime.toFixed(1) + ' Tage';
        }
        
        function updateCharts(data) {
            // Availability Chart
            const availCtx = document.getElementById('availabilityChart').getContext('2d');
            
            if (availabilityChart) {
                availabilityChart.destroy();
            }
            
            availabilityChart = new Chart(availCtx, {
                type: 'bar',
                data: {
                    labels: data.map(v => v.vendor_name),
                    datasets: [{
                        label: 'Verfügbarkeitsrate %',
                        data: data.map(v => v.avg_availability_rate || 0),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Zuverlässigkeitsscore',
                        data: data.map(v => v.vendor_reliability_score || 0),
                        backgroundColor: 'rgba(118, 75, 162, 0.8)',
                        borderColor: 'rgba(118, 75, 162, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Vendor Verfügbarkeit & Zuverlässigkeit',
                            color: '#e0e0e0',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: '#333' },
                            ticks: { color: '#888' }
                        },
                        x: {
                            grid: { color: '#333' },
                            ticks: { color: '#888' }
                        }
                    }
                }
            });
            
            // Status Distribution Chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            
            if (statusChart) {
                statusChart.destroy();
            }
            
            const totalAvailable = data.reduce((sum, v) => sum + (v.available_products || 0), 0);
            const totalOutOfStock = data.reduce((sum, v) => sum + (v.out_of_stock_products || 0), 0);
            const totalLimited = data.reduce((sum, v) => sum + (v.limited_products || 0), 0);
            
            statusChart = new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Verfügbar', 'Nicht verfügbar', 'Begrenzt'],
                    datasets: [{
                        data: [totalAvailable, totalOutOfStock, totalLimited],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(245, 158, 11, 0.8)'
                        ],
                        borderColor: [
                            'rgba(16, 185, 129, 1)',
                            'rgba(239, 68, 68, 1)',
                            'rgba(245, 158, 11, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Produktstatus-Verteilung',
                            color: '#e0e0e0',
                            font: { size: 16 }
                        },
                        legend: {
                            labels: { color: '#e0e0e0' }
                        }
                    }
                }
            });
        }
        
        function updateTable(data) {
            const tbody = document.getElementById('vendorTableBody');
            tbody.innerHTML = data.map(vendor => {
                const availabilityRate = vendor.avg_availability_rate || 0;
                const statusClass = availabilityRate >= 90 ? 'available' : 
                                  availabilityRate >= 70 ? 'limited' : 'out';
                const statusText = availabilityRate >= 90 ? 'Gut' : 
                                 availabilityRate >= 70 ? 'Mittel' : 'Niedrig';
                
                return `
                    <tr>
                        <td>${vendor.vendor_name}</td>
                        <td>${availabilityRate.toFixed(1)}%</td>
                        <td>${(vendor.vendor_reliability_score || 0).toFixed(1)}</td>
                        <td>${vendor.product_count || 0}</td>
                        <td><span class="status-badge status-${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            }).join('');
        }
        
        // Load sample data on page load
        window.addEventListener('load', () => {
            document.getElementById('dataInput').value = JSON.stringify(sampleData, null, 2);
            loadData();
        });
    </script>
</body>
</html>